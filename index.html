<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ana Inteligente - AI</title>
<style>
/* ===================== Estilos gerais ===================== */
body {
    font-family: 'Nunito', 'Arial', sans-serif;
    background: linear-gradient(135deg, #a259c6 0%, #6d28d9 100%);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
}
/* ===================== Chat ===================== */
.chat-container {
    background: #fff;
    border-radius: 24px;
    box-shadow: 0 4px 24px rgba(108,52,131,0.15);
    width: 100%;
    max-width: 420px;
    margin-top: 48px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 3px solid #a259c6;
}
.chat-header {
    background: linear-gradient(90deg, #a259c6 0%, #6d28d9 100%);
    color: #fff;
    padding: 22px 0 18px 0;
    font-size: 1.5em;
    text-align: center;
    font-weight: 800;
    letter-spacing: 1px;
    position: relative;
}
#resetChat {
    position: absolute;
    right: 10px;
    top: 12px;
    background: transparent;
    border: none;
    color: #fff;
    cursor: pointer;
}
.chat-messages {
    flex: 1;
    padding: 24px 18px 18px 18px;
    overflow-y: auto;
    height: 380px;
    background: #f6f2fa;
}
.message {
    margin-bottom: 18px;
    display: flex;
    flex-direction: column;
}
.message.user { align-items: flex-end; }
.message.bot { align-items: flex-start; }
.message-content {
    padding: 14px 18px;
    border-radius: 20px 20px 4px 20px;
    max-width: 85%;
    font-size: 1.08em;
    box-shadow: 0 2px 8px rgba(162, 89, 198, 0.07);
    font-weight: 500;
}
.message.user .message-content {
    background: linear-gradient(90deg, #a259c6 0%, #6d28d9 100%);
    color: #fff;
    border-bottom-right-radius: 4px;
    border-bottom-left-radius: 20px;
}
.message.bot .message-content {
    background: #ede9f7;
    color: #6d28d9;
    border-bottom-left-radius: 4px;
    border-bottom-right-radius: 20px;
}
.chat-input {
    display: flex;
    border-top: 2px solid #ede9f7;
    background: #faf6ff;
}
.chat-input input[type="text"] {
    flex: 1;
    border: none;
    padding: 18px;
    font-size: 1.08em;
    outline: none;
    background: transparent;
}
.chat-input button {
    background: linear-gradient(90deg, #a259c6 0%, #6d28d9 100%);
    color: #fff;
    border: none;
    padding: 0 32px;
    cursor: pointer;
    font-size: 1.08em;
    font-weight: 700;
    transition: background 0.2s;
}
.chat-input button:hover { background: linear-gradient(90deg, #6d28d9 0%, #a259c6 100%); }

/* ===================== Minigame ===================== */
.quiz-container {
    margin: 20px auto 0 auto;
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 2px 8px rgba(108,52,131,0.08);
    max-width: 340px;
    width: 100%;
    padding: 14px 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
}
.quiz-title { font-size: 1em; font-weight: 700; color: #6d28d9; margin-bottom: 4px; }
.quiz-avatar { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #a259c6; margin-bottom: 10px; object-fit: cover; background: #fff; }
.quiz-score { font-size: 0.9em; color: #a259c6; margin-bottom: 8px; font-weight: 600; }
.quiz-question { font-size: 0.9em; color: #333; margin-bottom: 12px; text-align: center; min-height: 36px; }
.quiz-btns { display: flex; gap: 14px; }
.quiz-btn { width: 40px; height: 40px; border-radius: 50%; border: none; font-size: 1.3em; font-weight: 700; color: #fff; background: linear-gradient(135deg, #a259c6 0%, #6d28d9 100%); cursor: pointer; }
.quiz-difficulty { display: flex; gap: 6px; margin-bottom: 8px; justify-content: center; }
.quiz-difficulty-btn { background: #ede9f7; color: #6d28d9; border: 1px solid #a259c6; border-radius: 6px; padding: 2px 10px; font-size: 0.8em; font-weight: 600; cursor: pointer; }
.quiz-difficulty-btn.selected { background: linear-gradient(135deg, #a259c6 0%, #6d28d9 100%); color: #fff; border: 1px solid #6d28d9; }
.quiz-feedback { margin-top: 6px; font-size: 0.85em; font-weight: 600; color: #6d28d9; min-height: 18px; }

/* ===================== Bolhas ===================== */
.bubbles-bg { position: fixed; top:0; left:0; width:100vw; height:100vh; z-index:1; pointer-events:none; overflow:hidden; }
.bubble { position: absolute; bottom: -120px; border-radius: 50%; opacity: 0.22; background: linear-gradient(135deg,#a259c6 60%,#6d28d9 100%); animation: bubbleUp 12s linear infinite; }
@keyframes bubbleUp { 0%{transform:translateY(0) scale(1);opacity:0.22;} 80%{opacity:0.22;} 100%{transform:translateY(-110vh) scale(1.1);opacity:0;} }

</style>
</head>
<body>

<!-- Chat -->
<div class="chat-container" id="chatContainer">
    <div class="chat-header">Ana Inteligente
        <button id="resetChat" title="Resetar conversa">⟳ Resetar</button>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <form class="chat-input" id="chatForm">
        <input type="text" id="userInput" placeholder="Digite sua mensagem..." autocomplete="off" required />
        <button type="submit">Enviar</button>
    </form>
</div>

<!-- Minigame -->
<div class="quiz-container" id="quizContainer">
    <div class="quiz-title">Nerd dos Pontos</div>
    <img class="quiz-avatar" src="nerd.png" alt="Nerd dos Pontos">
    <div class="quiz-score" id="quizScore">Pontos: 0</div>
    <div class="quiz-difficulty" id="quizDifficulty">
        <button class="quiz-difficulty-btn selected" data-diff="facil">Fácil</button>
        <button class="quiz-difficulty-btn" data-diff="medio">Médio</button>
        <button class="quiz-difficulty-btn" data-diff="dificil">Difícil</button>
    </div>
    <div class="quiz-question" id="quizQuestion">Carregando pergunta...</div>
    <div class="quiz-btns">
        <button class="quiz-btn" id="btnTrue" title="Verdadeiro">O</button>
        <button class="quiz-btn" id="btnFalse" title="Falso">X</button>
    </div>
    <div class="quiz-feedback" id="quizFeedback"></div>
</div>

<div class="bubbles-bg" id="bubblesBg"></div>

<script>
// ===================== Minigame =====================
const quizQuestions = {
    facil: [ {q:'A água ferve a 100°C ao nível do mar.',a:true}, {q:'O Sol é um planeta.',a:false} ],
    medio: [ {q:'A baleia-azul é o maior animal do mundo.',a:true}, {q:'O número pi é aproximadamente 3,14.',a:true} ],
    dificil: [ {q:'A constante de Planck é aproximadamente 6,63 x 10^-34 J·s.',a:true}, {q:'A Guerra dos Cem Anos durou exatamente 100 anos.',a:false} ]
};
let quizScore = 0, quizIndex = 0, quizLevel = 'facil';
const quizScoreEl = document.getElementById('quizScore');
const quizQuestionEl = document.getElementById('quizQuestion');
const quizFeedbackEl = document.getElementById('quizFeedback');
const btnTrue = document.getElementById('btnTrue');
const btnFalse = document.getElementById('btnFalse');
const quizDiffBtns = document.querySelectorAll('.quiz-difficulty-btn');

function showQuizQuestion() {
    quizFeedbackEl.textContent='';
    const questions = quizQuestions[quizLevel];
    if(quizIndex>=questions.length){quizQuestionEl.textContent='Fim do jogo!'; btnTrue.disabled=true; btnFalse.disabled=true; return;}
    quizQuestionEl.textContent=questions[quizIndex].q;
}
function handleQuizAnswer(isTrue){
    const questions = quizQuestions[quizLevel];
    const correct = questions[quizIndex].a === isTrue;
    let points = quizLevel==='facil'?5:quizLevel==='medio'?10:15;
    if(correct){quizScore+=points; quizFeedbackEl.textContent='Acertou! (+'+points+')';}
    else{quizScore-=5; quizFeedbackEl.textContent='Errou! (-5)';}
    quizScoreEl.textContent=`Pontos: ${quizScore}`;
    quizIndex++;
    setTimeout(showQuizQuestion,900);
}
btnTrue.addEventListener('click',()=>handleQuizAnswer(true));
btnFalse.addEventListener('click',()=>handleQuizAnswer(false));
quizDiffBtns.forEach(btn=>{btn.addEventListener('click',()=>{
    quizDiffBtns.forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    quizLevel = btn.dataset.diff; quizIndex=0; quizScore=0;
    btnTrue.disabled=false; btnFalse.disabled=false;
    quizScoreEl.textContent='Pontos: 0';
    showQuizQuestion();
})});
showQuizQuestion();

// ===================== Bolhas =====================
function createBubbles(){
    const bubblesBg = document.getElementById('bubblesBg');
    for(let i=0;i<18;i++){
        const bubble=document.createElement('div'); bubble.className='bubble';
        const size = Math.random()*48+32; bubble.style.width=`${size}px`; bubble.style.height=`${size}px`;
        bubble.style.left=`${Math.random()*100}%`; bubble.style.animationDuration=`${9+Math.random()*6}s`;
        bubble.style.animationDelay=`${Math.random()*8}s`; bubblesBg.appendChild(bubble);
    }
}
createBubbles();

// ===================== Chat =====================
const chatMessages=document.getElementById('chatMessages');
const chatForm=document.getElementById('chatForm');
const userInput=document.getElementById('userInput');
const resetBtn=document.getElementById('resetChat');
let messages=[];

resetBtn.addEventListener('click',()=>{messages=[]; chatMessages.innerHTML='';});

function addMessage(role,content){
    const messageDiv=document.createElement('div'); messageDiv.className='message '+role;
    const contentDiv=document.createElement('div'); contentDiv.className='message-content';
    if(role==='user'){contentDiv.textContent=content;}
    else{contentDiv.textContent=content;}
    messageDiv.appendChild(contentDiv);
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop=chatMessages.scrollHeight;
}

chatForm.addEventListener('submit',async(e)=>{
    e.preventDefault();
    const userMsg=userInput.value.trim();
    if(!userMsg) return;
    addMessage('user',userMsg);
    messages.push({role:'user',content:userMsg});
    userInput.value='';
    addTypingIndicator();
    await sendMessageToAPI();
});

function addTypingIndicator(){
    const messageDiv=document.createElement('div'); messageDiv.className='message bot typing';
    const contentDiv=document.createElement('div'); contentDiv.className='message-content';
    contentDiv.innerHTML='<span class="typing-indicator">...</span>';
    messageDiv.appendChild(contentDiv);
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop=chatMessages.scrollHeight;
}
function removeTypingIndicator(){
    const typing = chatMessages.querySelector('.message.bot.typing');
    if(typing) typing.remove();
}

// ===================== Comunicação com Flask =====================
async function sendMessageToAPI(){
    try{
        const response = await fetch("/chat",{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:messages})});
        if(!response.ok) throw new Error('Erro na resposta do servidor');
        const data = await response.json();
        const botMsg = data.reply || 'Sem resposta da IA.';
        messages.push({role:'assistant',content:botMsg});
        removeTypingIndicator();
        addMessage('bot',botMsg);
    }catch(err){
        removeTypingIndicator();
        addMessage('bot','Erro: '+err.message);
    }
}
</script>
</body>
</html>
